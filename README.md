# -tkinter-存在借鉴部分，仅供学习参考

             
内蒙古科技大学
本科生课程设计说明书


题    目：基于python的图书馆管理系统
学生姓名：宋建兴
	  学    号：1965138226
	  专    业：信息管理与信息系统
	  班    级：信管2019 -2班
	  课设时间：2021-12-5
	  指导教师：王威
	  成    绩：
  
 

摘  要
Python是一种跨平台的，面向对象的程序设计语言。拥有丰富和强大的库，能够继承其他语言模块，与SQL Server连接操作简单，兼容性好。Python学习性强，强制缩进的方式使得代码可读性高，便于学习。
在信息化的时代中，应当使用计算机提供有关图书馆管理信息以供管理的系统。图书馆管理信息系统采集和存储与图书馆管理有关的数据，经过变换，向用户和管理员提供图书馆书籍变动、借阅情况、学生信用管理等管理信息，这些信息或者代替了管理人员的劳动，或者辅助管理人员进行管理。图书馆管理信息系统是图书馆自动化系统的组成部分，有助于图书馆高效运行。
关键词：Python、图书管理系统；管理信息系统；图书馆 
目录
摘  要	I
第一章 绪论	1
1.1 研究背景	1
1.2研究意义	1
1.3国内外研究	1
1.3.1 国外研究现状	1
1.3.2 国内研究现状	2
1.4 开发技术介绍	2
1.4.1 Python概述	2
1.4.2 SQL Server概述	2
1.4.3开发环境和运行环境	3
1.4主要研究内容及论文框架	3
第二章 图书馆管理系统规划	4
2.1 内蒙古科技大学图书馆简介	4
2.2 内蒙古科技大学图书馆运营状况	4
2.3 功能描述	6
第三章 图书馆管理系统可行性研究	8
3.1可行性分析	8
3.1.1 管理的可行性	8
3.1.2 技术的可行性	8
3.1.3 经济的可行性	8
3.1.4 结论	8
3.2 需求分析	8
3.3 图书管理系统业务流程分析	9
3.4 图书管理系统数据流程分析	10
3.5 数据字典	10
3.5.1 数据存储条目	11
3.5.2 数据项条目	11
3.5.3 数据流	12
3.5.4 处理逻辑	12
3.5.5 数据存储	12
第四章 系统设计	14
4.1 图书馆管理系统设计的原则和指导思想	14
4.2 功能结构设计	14
4.3 系统技术应用环境	15
4.3.1Python概述	15
4.3.2 SQL Server概述	15
4.3.3 开发环境和运行环境	15
4.4 编码设计	16
4.5 图书馆管理系统的数据库设计	16
4.5.1 概念结构设计	16
4.5.2 逻辑结构设计	17
4.5.3 物理结构设计	17
4.5.4 数据表的关系描述	19
4.6 图书管理系统界面设计	19
第五章 图书馆管理系统的实现及运行维护	21
5.1 数据准备	21
5.2 学生登录功能	22
5.3 查询图书信息功能模块	24
5.4 借阅图书模块	26
5.5 管理员登陆界面	27
5.6 其他功能模块	29
5.7其他事项说明	29
5.8 系统日常维护内容	29
5.9 应用规模与实用价值	29
第六章 总结与展望	31
6.1 总结	31
6.2 展望	32
附录一 关键代码	33
 
第一章 绪论
1.1 研究背景
Python是一种计算机程序设计语言，是一种动态、面向对象的脚本语言，最初被设计用于编写自动化脚本，随着版本的不断更新和语言新功能增加，越来越多被用于独立的、大型项目的开发。
Python已经成为最受欢迎的程序设计语言之一，自从2004年以后，Python的使用率呈线性增长，学习Python已经成为了广大数据分析人员的共识。
1.2研究意义
图书管理系统是经典的管理信息系统，一般图书馆总是面对巨大的书籍信息和图书信息，传统的管理方法既浪费人力也浪费物力，也容易产生各种各样的错误，为管理带来极大的不方便。另外，图书逾期也是各级各类图书馆普遍存在的问题，不仅是读者对图书馆公共资源的一种不合理占用，还在一定程度上影响了图书馆纸质资源的流通率和利用率。为了能够高效对信息进行管理、检索、查阅，对信息系统进行研究和引入是有必要的。
无论对于学生还是管理员，图书管理系统都方便了其对图书馆功能的操作使用，又能减少因为人工工作纰漏造成图书馆书本丢失、损坏的可能。至今高度信息化的世界，对于图书馆这种存储大量信息的区域，图书管理的重要性日益增加。
1.3国内外研究
1.3.1 国外研究现状
在国外，包括以色列、美国、澳大利亚等国家的几个公司都层开发出比较著名的图书馆管理系统，目前在国外的图书馆管理系统中ExLihris公司开发的Aleph500和澳大利亚公司DYNIX开发的Horizon系统是比较流行的。
美国盐城图书馆馆长布隆伯格认为，图书馆不应当使用简单粗暴的对逾期还书人员采取缴纳“逾期费”的处罚，因为逾期费对于人们公平地接受图书馆服务而言是个不平等的障碍。
1.3.2 国内研究现状
目前国内推广使用的汇文文献信息服务系统是由江苏省高校于1988年合作开发的图书管理系统，这套系统具有系统管理、典藏模块、期刊模块、编目模块等。 该系统运用了中间件技术，采用了C/S，B/S体系的系统结构，是能创建开放、创新的系统，它是基于图书馆文献资源共享和服务共享的分布式软件系统。能够支持多个系统平台，例如Windows2003、Linux、SCOUnixWare等。支持TCP/IP，NetBEUI等互联网通讯协议，该系统采用了大型的关系型数据库作为服务的平台。
笔者通过对国内院校图书馆借阅规则的分析与总结，发现高校图书馆在针对图书逾期问题上普遍过于注重事后对读者的催还和处罚，而忽略了事前预防和事中控制，也忽略了对自身业务和管理上的反思。
1.4 开发技术介绍
1.4.1 Python概述
Python是简约的语言，非常易于读写。在遇到问题时，我们可以把更多的注意力放在问题本身上，而不用花费太多精力在程序语言、语法上。Python社区创造了各种各样的Python库。在此中可以管理文档，执行单元测试、数据库、web浏览器、电子邮件、密码学、图形用户界面和更多的东西。
Python既支持面向过程，也支持面向对象编程。在面向过程编程中，程序员复用代码，在面向对象编程中，使用基于数据和函数的对象。尽管面向对象的程序语言通常十分复杂，Python却设法保持简洁。Python兼容众多平台，所以开发者不会遇到使用其他语言时常会遇到的困扰。
1.4.2 SQL Server概述
SQL Server 2016 是 Microsoft 数据平台历史上最大的一次跨越性发展，提供了可提高性能、简化管理以及将数据转化为切实可行的见解的各种功能，而且所有这些功能都在一个可在任何主流平台上运行的漏洞最少的数据库上实现。
主要功能编辑有：实时运营分析、高可用性和灾难恢复、安全性和合规性、性能最高的数据仓库、将复杂的数据转化为切实可行的见解、移动商业智能等。
1.4.3开发环境和运行环境
（1）开发环境
开发工具：Pycharm
开发语言：Python
数据库应用：SQL Server 2016
（2）运行环境软硬件要求
CPU：AMD Ryzen5 3500U及以上；Intel i5 10th及以上 
内存要求：16G以上
显示屏要求：1920x1080分辨率以上
1.4主要研究内容及论文框架
本课题以满足图书馆的图书管理需求为导向，以客户需求为目的进行开发。本系统使用计算机技术对学校图书馆进行电子化管理，使它具有图书管理系统相较于传统的手工管理模式具有检索方便快捷、检索速度快、检索结果准确、存储数据量大、成本低、节省资源、且具有良好的人机交互界面等功能的一款信息管理系统。
本课题主要解决为图书馆建立一个可以满足借阅者和图书馆工作人员的需求具备用户管理、读者管理、图书管理、借阅信息查询等功能等功能的图书馆管理系统。
本论文框架简要为概述、系统规划、系统分析及设计、系统的实施、运行与维护、开发过程中遇到问题及解决方案几个模块进行概述。
第二章 图书馆管理系统规划
2.1 内蒙古科技大学图书馆简介
内蒙古科技大学图书馆是学校 “教学科研基础大平台”。经过50多年的建设与发展，本馆已成为一所包头地区馆藏文献最多、现代化程度最高、服务最全面的综合性图书馆。
秉承“开发利用第一，数字化技术优先，管理服务效益并重”的办馆指导思想，围绕“推广普及阅读，营建书香校园”的办馆宗旨和“馆藏资源数字化、网络资源馆藏化、资源管理一体化、服务形式多样化”的办馆目标，坚持“知识改变命运，学习成就未来”的宣传理念，致力于不断加强传统文献资源建设，大力开展数字化文献资源建设和现代化管理与人文化服务工作，已经形成了实体与虚拟共进的馆藏格局和传统与现代并举的服务模式。
2.2 内蒙古科技大学图书馆运营状况
图书馆建筑面积达到4万平方米；各类阅览室近40个；普通阅览座位2376席，电子阅览座位541席，总计达到4000多席。现设有办公室、资源建设部、学科服务部、文献检索教研室、技术部、阅览部、期刊阅览部等七个部门。
图书馆组织结构较为清晰简明，由四个部门构成主要组织结构。其组织结构由图 2.1所示。图书馆由馆长负责全面工作，下设办公室、资源建设部、学科服务部、文献检索教研室、技术部、阅览部、期刊阅览部。
图书馆由馆长负责全面工作，下设办公社，财务室，采编室，学术论文室，图书借阅室，电子阅览室，期刊阅览室和技术支持室。各部门的业务职责如下：
办公室：办公室协助馆长负责日常工作，了解客户需求，制定采购计划。
资源建设部：资源建设部负责图书的采购，入库和图书编目，编目后的图书粘帖标签，并送图书借阅室上架借阅。并负责图书馆的财务收支。
学科服务部：负责学术论文的收集整理。
图书借阅部：提供对读者的书目查询服务和图书借阅服务。收集整理电子读物，准备电子读物的借阅服务，目前可以提供目录查询和借阅。
期刊阅览室：负责期刊的收集整理和借阅。
技术部：负责对图书馆的网络和计算机系统提供技术支持。
文献检索教研室：负责进一步研究关于图书整理、检索等学科技术手段。允许学生利用其研究成果进行查询分析。
数据类
数据项	计划	财务	刊物	学术材料	新书	图书编号	下架书	成本	借书单	意见	图书目录	读者	图书
采购计划	C						U					U	
财务规划		C						U					
期刊论文整理			C	C									
采编图书					C	C		U					U
期刊借阅			U		U			C					
图书借阅			U				U		C				
电子阅览			U										
图书归还									U			U	
期刊归还			U						U				
期刊查询			U										
论文查询				U									
期刊查阅			U										
论文查阅				U									
书籍查询											C		U
注销挂失												U	
信息反馈										C		U	
系统维护	U												

 
图2.1 组织结构图
2.3 功能描述
本地区的图书馆大部分还是从事手工工作，工作效率很低，由于人为因素可能会造成不必要的信息错误，给后续工作带来不便。为了使信息简便管理和检索方便。应该满足以下几个管理需求：
（1）	读者的注册与登录
能够使读者依据学号注册含6位密码的账户。由于账户信息中含有读者的个人信息，加入登录密码能够较好的对用户隐私进行保护。
（2）	图书信息的管理
能够输出缺书信息、读者捐书信息和购入、下架的图书信息并通过操作该系统对后台数据库进行修改。能够提供用户对书籍信息进行查询的功能。
（3）	图书的借阅查询
日常图书馆务，读者会进行对图书的归还和借出，产生借阅信息，应该制定归还期限，对借出归还图书进行登记，出入库产生变量，和书库信息产生关联。
（4）	读者信息的管理
入馆读者对信息进行登记，产生读者信息，对读者信息查看修改检索。能够从管理员界面对用户信息进行查询。
（5） 读者信誉分管理
是帮助高校学生养成诚实守信习惯的惩戒教育方式。其目的是帮助学生养成“有借有还、再借不难”的按时还书守信习惯。同时，可以对捐书等良好行为做出奖励。
（6） 公告的发布与查看
管理员能够以公告的形式发布所有学生可见的信息，通知活动举办、新进或下架图书、图书馆开闭场馆时间调整等信息。
第三章 图书馆管理系统分析
3.1可行性分析
3.1.1 管理的可行性
图书馆业务较为简单，用户身份较少，数据类型较为单一。另外，图书馆对于信息化建设有较大的需求，从管理角度可行性大。
3.1.2 技术的可行性
本人具有一定的Python程序设计编写能力，并且目标系统并不复杂，开发的周期较短。同时，开发期限较为宽裕，预计可以在规定期限内完成开发任务。技术和工期均满足要求。从技术角度考虑，此信息系统开发可行。
3.1.3 经济的可行性
由于目标系统开发需求比较低，且开发工具Pycharm Community属于开源的免费软件，该系统开发具有成熟的软硬件环境。同时学校能够提供网络和计算机等软硬件的支持。当系统开发完成进行运用，将很大程度上提高效率，能减少财力支出。从经济角度考虑，此信息系统开发可行。
3.1.4 结论
根据以上分析可知，开发该图书馆管理信息系统不仅符合经济效益，也能提高管理效益，也节省了大量资源，在经济上、技术上、管理上可行，因此，可以开始进行对系统的开发。
3.2 需求分析
图书管理系统是经典的管理信息系统，一般图书馆总是面对巨大的书籍信息和图书信息，传统的管理方法既浪费人力也浪费物力，也容易产生各种各样的错误，为管理带来极大的不方便。为了能够高效对信息进行管理、检索、查阅，对信息系统进行研究和引入是有必要的。
无论对于学生还是管理员，图书管理系统都方便了其对图书馆功能的操作使用，又能减少因为人工工作纰漏造成图书馆书本丢失、损坏的可能。至今高度信息化的世界，对于图书馆这种存储大量信息的区域，图书管理的重要性日益增加。
因此，需要一个具有学生和管理员两个子系统的管理系统。
3.3 图书管理系统业务流程分析
业务流程图是一种描述管理系统内各单位、人员之间的业务关系，作业顺序和管理信息流向的图表。它用一些规定的符号及连线表示某个具体业务的处理过程,帮助分析人员找出业务流程中的不合理流向。
本文业务流程中出现的符号作如下说明，如图3.1所示。
以下是对业务的基本说明。
管理员通过购入图书或读者捐赠图书丰富图书馆馆藏。管理员进行核对图书编目生成书单，然后根据书单更新借阅信息。在读者进行结束操作和捐书操作时分别对图书馆数据库进行更新操作。
图书管理员的业务流程如图3.2所示。
 
图 3.2业务流程图
3.4 图书管理系统数据流程分析
数据流程图，是一种能全面地描述系统数据流程的主要工具，它用一组符号来描述整个系统中信息的全貌，综合地反映出信息在系统中的流动、处理和存储情况。
本文数据流程中出现的符号作如下说明，如图3.3所示。
管理员图书编目、更新图书信息及更新借阅信息等处理数据流程，如图3.4所示。
 
图3.4 数据流程图
3.5 数据字典
数据字典是指对数据的数据项、数据结构、数据流、数据存储、处理逻辑等进行定义和描述，其目的是对数据流程图中的各个元素做出详细的说明，使用数据字典为简单的建模项目。简而言之，数据字典是描述数据的信息集合，是对系统中使用的所有数据元素的定义的集合。
数据字典（Data dictionary）是一种用户可以访问的记录数据库和应用程序元数据的目录。主动数据字典是指在对数据库或应用程序结构进行修改时，其内容可以由DBMS自动更新的数据字典。被动数据字典是指修改时必须手工进行更新内容的数据字典。
3.5.1 数据存储条目
数据存储编号：0001
数据存储名称：编目书单 
简述： 图书信息
组成：图书编号+书名+作者+库存量
关键字：图书编号
数据存储编号：00001
数据存储名称：借书单 
简述：学生图书借阅信息
组成：借阅编号+读者ID+图书编号+借出日期+归还日期
3.5.2 数据项条目
数据项名称：学号（sno）
简述：学生身份识别号码
类型：字符串
长度：20

数据项名称：图书编号（bno）
简述：用于识别图书的编号
类型：字符串
长度：20

数据项名称：借书单单号（lid）
简述：用于标识学生的一次借书操作
类型：字符串
长度：20
3.5.3 数据流
定      义：数据流由一个或一组固定的数据项或数据结构组成
数据流编号：bno
数据流名称：图书编号
简		 述：程序生成的图书编号，用于唯一确定该图书
数据流来源：Python程序语句
数据流去向：图书馆管理系统
数据流组成：字符串‘0’+ 下一位表中编号 
数据流量：约10份/分钟
高峰流量：约20份/分钟
3.5.4 处理逻辑
	定		   义：对数据流程图中最底层的处理逻辑加以说明
	处理逻辑编号：计算表中编号
	输入的数据流：select count(1) from books
	处			理： 
sql = "select count(1) from books"
   	cursor.execute(sql)
   	results = cursor.fetchall()
   	num = results[0][0]
   	bno = ("0" * (4 - len(str(num))) + str(num + 1))
	输出的数据流：bno
处理频率：随图书更新，更新一次
3.5.5 数据存储
定        义：是数据结构保存的场所，只在数据字典中描述数据的逻辑存储结构，不涉及它的物理组织
数据存储编号：books
数据存储名称：图书信息表
简        述：数据库中存储图书信息的表
数据存储组成：bno\bname\bauthor\bnum
关键字：bno

第四章 系统设计
4.1 图书馆管理系统设计的原则和指导思想
（1）系统性原则。在系统设计中要从整个系统的角度进行考虑，注意保证系统的一致性和完整性。
（2）灵活性及可变性原则。灵活性是指系统对外界环境变化的适应能力。
（3）可靠性原则。可靠性指系统抵御外界干扰的能力及受外界干扰时的恢复能力。
（4）经济性原则。经济性是指在满足系统要求的前提下，不仅追求给用户带来一定的效益，还应尽可能减少系统不必要的开销。
4.2 功能结构设计
系统分为学生和教师两部分，具体功能结构见4.1功能结构图
 
其中具体功能如下：
（1）“注册/登录”此功能分为两部分，一部分是读者及学生的注册/登录，另一部分是管理员的登录。为了避免用户操作失误，保障信息安全，管理员账号无法在系统中注册。
（2）“本人信息管理”，可以通过“查看和修改个人信息”和“修改密码”，查看个人信息和对自己的个人信息及密码进行修改。
（3）“图书管理”（用户），可以进行查找图书、借阅图书、归还图书等操作。
（4）“图书管理”（管理员），可以进行打印缺书单、查询馆藏图书信息、查询读者借阅记录、购入新图书等操作。
（5）征信管理功能征信系统主要用来约束学生行为，培养按时归还图书的好习惯。采用可借书目上线降低作为逾期不换书、信誉积分下降的惩罚，而非是粗暴的罚款手段。
4.3 系统技术应用环境
4.3.1 Python概述
Python是简约的语言，非常易于读写。在遇到问题时，我们可以把更多的注意力放在问题本身上，而不用花费太多精力在程序语言、语法上。Python社区创造了各种各样的Python库。在此中可以管理文档，执行单元测试、数据库、web浏览器、电子邮件、密码学、图形用户界面和更多的东西。
Python既支持面向过程，也支持面向对象编程。在面向过程编程中，程序员复用代码，在面向对象编程中，使用基于数据和函数的对象。尽管面向对象的程序语言通常十分复杂，Python却设法保持简洁。Python兼容众多平台，所以开发者不会遇到使用其他语言时常会遇到的困扰。
4.3.2 SQL Server概述
SQL Server 2016 是 Microsoft 数据平台历史上最大的一次跨越性发展，提供了可提高性能、简化管理以及将数据转化为切实可行的见解的各种功能，而且所有这些功能都在一个可在任何主流平台上运行的漏洞最少的数据库上实现。
主要功能编辑有：实时运营分析、高可用性和灾难恢复、安全性和合规性、性能最高的数据仓库、将复杂的数据转化为切实可行的见解、移动商业智能等。
4.3.3 开发环境和运行环境
（1）开发环境
开发工具：Pycharm
开发语言：Python
数据库应用：SQL Server 2016
（2）运行环境软硬件要求
CPU：AMD Ryzen5 3500U及以上；Intel i5 10th及以上 
内存要求：16G以上
显示屏要求：1920x1080分辨率以上
4.4 编码设计
Tkinter 是 Python 的标准 GUI 库。Python 使用 Tkinter 可以快速的创建 GUI 应用程序。
控件及描述如下“
Button	按钮控件；在程序中显示按钮。
Entry	输入控件；用于显示简单的文本内容
Frame	框架控件；在屏幕上显示一个矩形区域，多用来作为容器
Label	标签控件；可以显示文本和位图
Menu	菜单控件；显示菜单栏,下拉菜单和弹出菜单
Message	消息控件；用来显示多行文本，与label比较类似
Text	文本控件；用于显示多行文本
tkMessageBox	用于显示你应用程序的消息框。
函数名如book_check用于读取数据库中books表以获取图书信息。另有其他函数通过对数据库和GUI界面的不同操作实现了不同功能。
4.5 图书馆管理系统的数据库设计
4.5.1 概念结构设计
E-R图也称实体-联系图(Entity Relationship Diagram)，为表示实体类型、联系和属性提供了方法。错误!未找到引用源。E-R图出现的符号所代表的具体含义，如图4.2所示。
图4.2 符号涵义
在该图书管理系统中，主要处理管理员，读者、图书之间的业务处理关系，如图4.3所示。
 
图 4.1系统E-R图
4.5.2 逻辑结构设计
其关系模型如下：
管理员（管理员编号，密码）
读者（学号，密码，姓名，性别，班级，信誉积分）
图书（图书编号，书名，作者，馆藏数量）
借阅（借阅单号，学号，图书编号，借阅时间，归还时间）

4.5.3 物理结构设计
系统数据库使用SQL Server数据库，系统数据库名称为Library，下面给出数据表的简要说明，数据表关系描述的摘要以及主数据表的结构.
表4.1为管理员信息列表，记录系统管理员信息。
表 4.1  mpass表
列名	数据类型	长度	允许空	注释
mno	int		否	管理员编号
mpassward	char	6	否	管理员密码

表4.2为读者信息列表，记录读者信息。
表 4.2 Reader表
列名	数据类型	长度	允许空	注释
rno	char	20	否	学号
rname	char	20	否	姓名
rsex
rclass	char
char	5
20	否
否	性别
学生班级
rbleft	int		否	信誉积分

表4.3为图书信息列表，记录图书信息。
表 4.3 Book表
列名	数据类型	长度	允许空	注释
bno	char	20	否	图书编号
bname	char	50	否	书名
bauthor	char	50	是	作者
bnum	int		是	馆藏数量

表4.4为借阅信息列表，记录读者借阅信息。
表 4.4 Borrow表
列名	数据类型	长度	允许空	注释
lid	char	20	否	借阅单号
rno	char	20	否	学号
bno	char	20	否	图书编号
btime	datetime		是	借出时间
rtime	datetime		是	归还时间



4.5.4 数据表的关系描述
 
图4.4 图书管理系统的数据关联图
借书表依赖于books表的bno主码和reader表的rno主码，其中借书表还有主码lid唯一标识该借书信息。这样，即使同一学生多次借阅多一本书也不会出现主码重复的错误。
4.6 图书管理系统界面设计
身份选择界面如下：
 
学生功能界面如下：
 
管理员功能界面如下：
 
第五章 图书馆管理系统的实现及运行维护
5.1 数据准备
books表：查询适合青年大学生阅读的书单一份，进行录入，作为初始版本的books表内容。投入使用后由用户捐书、管理员购入新书、下架图书等操作进行后续更改。
rpass、reader表：由用户注册操作产生
borrow表：由用户借书操作产生
mpass表：在数据库中进行初始输入产生
5.2 系统用例
 
图5.1 系统用例图
5.3 学生登录功能
登录功能的程序流程图如图5.1所示
 
图5.2 登录功能程序流程图
在此系统中，首先进入的是身份选择界面，在选择身份后输入此身份相应的用户名和密码。学生身份可以在系统中自行注册操作。
 
图5.3 登录选择界面
	选择普通用户，进入学生界面，有三种功能选择：登入、注册和退出
 
图5.4 学生界面
遇到的问题如下：
这两个界面是系统制作之初最先创建的，主要解决了数据库的连接问题和窗口创建的思路问题。
一、思路问题
在查阅资料后选择调用pymssql库进行数据库连接。
pymssql库是Python语言用于连接SQL Server数据库的驱动程序（或者称作DB API），它是最终和数据库进行交互的工具。SQLAlchemy包就是利用pymssql包实现和SQL Server数据库交互的功能的。
pymssql模块由Connection和Cursor 两个大类构成：
1.Connection类代表MS SQL Sever数据库的一个连接，
2.Cursor类用于向数据库发送查询请求，并获取查询的的结果。
二、数据库连接问题
pymssql.connect('LAPTOP-M7P04LP7','','','library',charset = 'utf8')
由于通过浏览网上关于连接数据库的帖子多数都使用SQL Server身份验证，因此需要安装数据库时设置的账号和密码，所以尝试了各种常用的密码组合都无法连接。后来发现我采用的是windows身份验证，无需账号和密码。将账号和密码位置设置为’’和’’后连接成功。连接属性依次是：服务器名、用户名（空）、密码（空）、数据库名。
连接数据库及登录代码见附录一 1。 
5.4 查询图书信息功能模块
 
	该部分主要解决了传参问题和输出问题。由于python3版本采用的是GBK的解码方式，该解码方式的中国通用的编码utf-8。
 
而数据库SQL Server采用的中文解码方式并不是utf-8，在系统测试时发现在从数据库中读取数据时会出现中文乱码的问题。如下图所示：
 
解决方法是声明解码方式为utf-8，具体操作如下：
1.在文件开头说明文件编码
#coding=utf-8
2.在连接参数中声明解码方式
将SQL操作语句conn = pymssql.connect(server,'','', database)中加入utf-8的声明代码，修改如下
conn = pymssql.connect(server,'','', database,"utf8")
3.使用excute方法执行SQL语句时加入解码方式声明
cur.execute(sql.encode('latin-1').decode('gbk'))
4.在输出时加入解码方式声明
print(row[1].encode('latin-1').decode('gbk'))
经此操作后，输出中文正常，结果如下：
 
	传参问题的解决参考了CSDN中的程序，能够将用户输入的内容赋值给变量，并将该变量加入到SQL语句中执行。
	传参及中文解码方式转换的该部分代码见附录一 2。
5.4 借阅图书模块
用户可以在学生端进行借阅书籍操作。在借书时需要输入欲借阅的书名。在编程实现本部分功能时遇到了如下问题：
 
程序并未报错但无法完成借阅操作。
经检查发现，在最初设计程序时，写的操作语句如下：
sql = "INSERT INTO borrow(rno,bno,btime) VALUES(%s,'%s',getdate())" % (id, results[0])
无法正常的向借阅表中插入数据，无法完成借阅操作。经检查后发现借阅表的主码是借阅单号bno，不能为空。而用户输入内容里面不包含bno，另外，由于主码的独特性，不能让用户自己输入，应该由程序自动生成。
解决方法如下：
sql = "select count(1) from borrow"
查询当前表长
num = results[0][0]
lid = ("0" * (5 - len(str(num))) + str(num + 1))
	设计的bno主码形如‘00001’，数字依次排序，剩余部分填充字符‘0’至五位。查询表长num后，下一个编号数字位num+1，利用5 - len(str(num))得出需要填充‘0’的位数，“0”*此位数填充，主码生成完成。在传参时加入lid参数，内容是bno。
	修改后结果如下：
 
	借阅部分代码见附录一 3。
5.5 管理员登陆界面
运行结果如下图所示
为了让程序看起来更美观，我加入了一些图片作为插图
 
插入语句如下：
photo=tk.PhotoImage(file= "C:/Users/Sakura/Pictures/1.jpg")
	运行后报错，查询得在python3中使用直接插入的方法无法处理jpg文件，可以处理png文件。将图片文件后缀改为png后，仍然不能运行。查资料得使用改后缀的方法只能从表面上修改文件格式，实际上图片的解码方式仍未改变。需要用到图片格式转换器。在此分享一个在线修改格式的网页https://www.gaitubao.com/jpg-gif-png/。
	由于没有在程序中声明图片大小，插入图片后图片尺寸过大，只显示了图片左上角的部分区域。利用绘图软件将图片文件的尺寸改为原来的1/10，显示正常。
5.6 信誉积分模块
在处理信誉积分模块时，遇到最多的是逻辑问题。例如：当信誉积分减到零时如果进行还书操作如何处理、如何在信誉积分过低的时候防止其降为复数而无法恢复、如何避免因卡借还书时间导致可借阅数量降为复数等。最终调整了代码顺序，将积分操作过程放在还书部分，即还书时对信誉积分进行加减。
另外，在程序初始版本中将信誉积分→可借书目的操作放在查看个人信息部分并设置为全局变量。但是如此设计后造成无法即使刷新的问题。将转化操作分别设置在每一处涉及信誉积分变化的函数中，解决了此问题。
5.7 健壮处理
为了提高程序健壮性，避免因用户不当操作而报错，加入了更多判断条件，当用户产生不当操作（如：不借书就进行还书操作、在还书操作时输入并非自己借阅的图书等），能够有弹窗提示：
 
 
5.8 其他功能模块
由于其他功能模块在技术操作方面与上述模块相近，只需要视具体情况进行修改即可，因此未遇到较难解决的问题，在此不再赘述。功能详情请参考附录二：程序运行视频。
5.9 其他事项说明
由于python语言能够调用pymssql库进行数据库连接，不需要另外建立数据源。此外，如果有其他程序使用ODBC方法连接了该数据库，此程序会因为接口数据源被占用而产生无法运行的问题。
5.10 系统日常维护内容
一方面，数据库中借书与还书的时间记录方式为getdate获取当前时间，此方式获取的时间包括年-月-日 时-分-秒及秒后三位小数，数据量较大，会占用大量存储空间。另一方面，借阅书单号长度为5位，当借阅单数量超过99999后，数据库会出现无法生成新记录的错误。此外，借阅记录具有时效性，保留大量借阅记录意义不大。因此，可以根据实际借阅量每月或每年清除数据库中借阅记录的数据。
5.11 应用规模与实用价值
此项目理论上可以承受9999种图书输入，能够记录99999次用户的借阅记录。功能较为全面，界面设置简洁美观，程序运行要求配置较低，能够运行于大部分用户的设备。
第六章 总结与展望
6.1 总结
python语言虽然语法简洁，但是在设计完整程序时依然需要较为严谨的逻辑设计。此外，熟练掌握pymssql库函数可以轻松对数据库进行增、删、改、查等操作，完善系统的功能模块。对于在系统中使用的pymssql库操作总结如下：
1.利用pymssql.connect命令连接建立成功后，与数据库的交互主要是通过Cursor对象进行的：
cursor = conn.cursor()
2.sql指令通过execute系列方法来执行：
cursor.execute('sql语句')
3.在对数据提交修改时需要使用
conn.commit()
4.如果执行的是有返回值的sql语句，则可以通过Cursor对象的fetch系列方法来获取结果，结果默认为元组类型：
cursor.execute("SELECT COUNT(*) FROM books")
cnt = cursor.fetchone()[0]
5.遍历多个结果
cursor.execute('SELECT * FROM books')
row = cursor.fetchone()
while row:
    print("ID=%d, Name=%s" % (row[0], row[1]))
    row = cursor.fetchone()
	另外，一些地方取数据时将从数据库中取出的list行数据进行了切割，就可以取出从数据库中读取内容的某一确定值。
	例如：从数据库中取出的数据results为[‘5’]，利用操作num = results[0][0]便可以取出数值型数5。系统便得知此时数据库中borrow表中表长为5，及下一位数据项的主码数字应为6。
	在数据库的设计方面，需要提前绘制数据库设计图，能够避免数据库出现逻辑错误和主外键参照的错误。在此数据库的设计中，有较为良好的主外键设置。borrow表在参照books表和reader表时无问题产生。由于设置了固定长度，能够一定程度的避免用户在个人信息输入界面不同的输入格输入错误的内容。数据库表的创建全部由代码完成，有移植性强的优点。
	细节方面，在此次对于图书馆管理系统的更新中添加了更多细节：在还书界面可以看到自己已借阅的图书；在管理员界面查看某位同学的借阅情况的时候，其已归还的图书有横画线表示借还过程已完成，而未还书信息条头部会有缩进字符，与已完成的操作条目区分开。
本课题以满足图书馆的图书管理需求为导向，以客户需求为目的进行开发。本系统使用计算机技术，基于python语言完成系统设计，对学校图书馆进行系统化管理。相较于传统的手工管理模式，该系统具有检索方便快捷、检索速度快、检索结果准确、存储数据量大、成本低、节省资源、且具有良好的人机交互界面等优点。
6.2 展望
由于第一次进行完整的基于python的数据库程序设计，在系统开发中尚存在诸多需要改进的地方。例如rpass表可以与reader表合并、主键的生成可以在数据库中设置自增、在弹窗中数据无法对齐造成了不够美观的程序观感。
另外，由于在设计数据库时密码一项不甚设计了长度为6的char型，导致在用户注册账户时只能输入6位的密码，造成了程序功能不合理的问题。
在初步设计中，有图书馆论坛功能，但是由于技术不足、目前水平能力有限，该功能没有实现。
因此在下一步的工作中，我将继续完善该程序的功能并维护数据库。同时继续学习python和sql语言，了解更多实现功能的方法，逐步掌握熟练的程序设计和实现技术，巩固基础知识，在下一次的程序设计中弥补这些不足。
附录一 关键代码
1 登陆部分
def login_check():
    db = pymssql.connect('LAPTOP-M7P04LP7','','', "library",charset = 'utf8')
    cursor = db.cursor()
    passward=input2.get()
    global id
    id = input_id.get()
    sql = "SELECT rpassward FROM rpass WHERE rno = '%s'" % (id)
    cursor.execute(sql)
    results = cursor.fetchone()
    if results:
            if passward == results[0]:
                success_tip()
            else:
               msg._show(title='错误！',message='账号密码输入错误！')
    else:
        msg._show(title='错误！',message='您输入的用户不存在！')
    db.close()

2 图书查询模块
def book_select():
    v1=tk.StringVar()
    global root2
    root2=tk.Tk()
    root2.title("查询图书")
    global input_book
    labe1 = tk.Label(root2, text="请输入您要查询的图书名：", font=36).grid(row=0, column=0)
    input_book = tk.Entry(root2,textvariable=v1)
    input_book.grid(row=0,column=1)
    tk.Button(root2, text='确认', width=10, command=check_book).grid(row=1, column=0, sticky=tk.W, padx=10, pady=5)
    tk.Button(root2, text='取消', width=10, command=exit_login3).grid(row=1, column=1, sticky=tk.E, padx=10, pady=5)

3 图书借阅部分
def book_borrow():
    db = pymssql.connect('LAPTOP-M7P04LP7','','', "library",charset = 'utf8')
    cursor = db.cursor()
    sql = "SELECT rbleft FROM reader WHERE rno = %s" % (id)
    cursor.execute(sql)
    result = cursor.fetchone()
    v_borrow=tk.StringVar()
    if result[0] == 0:
        msg._show(title="错误",message="你已达最大借阅量，借阅失败")
    global root2
    root2 = tk.Tk()
    root2 .title("借阅")
    global input8
    labe1 = tk.Label(root2, text="请输入您要借阅的图书名：", font=36).grid(row=0, column=0)
    input8 = tk.Entry(root2, textvariable=v_borrow)
    input8.grid(row=1,column=0)
    tk.Button(root2, text='确认', width=10, command=borrow_end).grid(row=2, column=0, sticky=tk.W, padx=10, pady=5)
    tk.Button(root2, text='取消', width=10, command=exit_login3).grid(row=2, column=1, sticky=tk.E, padx=10, pady=5)
    db.close()

4 管理员查询用户借阅记录部分
def borrow_end():
    global root3
    root3 = tk.Tk()
    root3.title("借阅记录查询：")
    db = pymssql.connect('LAPTOP-M7P04LP7','','', "library",charset='utf8')
    cursor = db.cursor()
    name = input5.get()
    sql = "SELECT lid,bname,btime,rtime FROM borrow,reader,books WHERE borrow.bno=books.bno AND borrow.rno=reader.rno AND rname='%s'"%(name)
    cursor.execute(sql)
    results = cursor.fetchall()
    cur = 0
    #print(results)
    for i in results:
    tk.Label(root3,text="记录号为：%s 书名为：%s 借阅时间为：%s 还书时间为：%s"%(i[0],i[1].encode('latin-1').decode('gbk'),i[2],i[3]),justify=tk.LEFT,font=36).grid(row=cur,column=0)
    cur=cur+1
    db.close()

	5.判断还书是否超时(实例为判断超时情况)
db = pymssql.connect('LAPTOP-M7P04LP7', '', '', "library2.0", charset='utf8')
cursor = db.cursor()
sql = "SELECT btime FROM borrow WHERE lid = %s"%(lid)
cursor.execute(sql)
result = cursor.fetchone()
btime = result[0]
#print(btime)
btime = str(btime)
btime2 = btime.rpartition('.')[0]
#print(btime2)
btime3 = datetime.datetime.strptime(btime2, '%Y-%m-%d %H:%M:%S')
btime4 = btime3 + datetime.timedelta(days=15)  
db = pymssql.connect('LAPTOP-M7P04LP7', '', '', "library2.0", charset='utf8')
cursor = db.cursor()
sql = "SELECT rtime FROM borrow WHERE lid = %s" % (lid)
cursor.execute(sql)
result = cursor.fetchone()
rtime = result[0]
rtime = str(rtime)
rtime2 = rtime.rpartition('.')[0]
rtime3 = datetime.datetime.strptime(rtime2, '%Y-%m-%d %H:%M:%S') 
diff = btime4-rtime3
diff2 = rtime3-btime3
if diff.days <0:
    db = pymssql.connect('LAPTOP-M7P04LP7', '', '', 'library2.0', charset='utf8')
    cursor = db.cursor()
    sql = "update books set bnum = bnum+1 where bno= '%s'" % (bno)
    cursor.execute(sql)
    db.commit()
    msg._show(title='成功', message='还书成功,您的还书已超时，将扣除您的信誉积分')  #实际还书超过了应还时间
    db = pymssql.connect('LAPTOP-M7P04LP7', '', '', "library2.0", charset='utf8')
    cursor = db.cursor()
    a = id
    # print(a)
    sql2 = "SELECT rbleft FROM reader WHERE rno = %s" % (a)
    # print("1")
    cursor.execute(sql2)
    results = cursor.fetchall()
    # print(results)
    b = int(results[0][0]) - 3
    # print(b)
    sql3 = "UPDATE reader SET rbleft = %s WHERE rno = %s" % (b, a)
    cursor.execute(sql3)
    db.commit()

